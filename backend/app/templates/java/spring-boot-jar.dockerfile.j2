# Spring Boot JAR Application Dockerfile
# Generated by Dockerfile Generator

FROM {{ base_image }} AS runtime

# Install system dependencies
{% if system_dependencies %}
RUN apk add --no-cache {{ system_dependencies | join(' ') }}
{% endif %}

# Create non-root user
RUN addgroup -S {{ user }} && adduser -S {{ user }} -G {{ user }}

WORKDIR /app

# Copy JAR file
COPY --chown={{ user }}:{{ user }} {{ jar_file_name }} app.jar

# Switch to non-root user
USER {{ user }}

# Set environment variables
{% if environment_vars %}
{% for key, value in environment_vars.items() %}
ENV {{ key }}="{{ value }}"
{% endfor %}
{% endif %}
{% if service_url %}
ENV SERVICE_URL="{{ service_url }}"
{% endif %}

# Expose port
EXPOSE {{ port }}

# Health check
{% if health_check_path %}
HEALTHCHECK --interval=30s --timeout=3s --start-period=40s \
  CMD wget --no-verbose --tries=1 --spider http://localhost:{{ port }}{{ health_check_path }} || exit 1
{% endif %}

# Run Spring Boot application
{% if custom_start_command %}
ENTRYPOINT [{{ custom_start_command.split() | map('tojson') | join(', ') }}]
{% else %}
ENTRYPOINT ["java", {{ jvm_options | split_jvm_options | map('tojson') | join(', ') }}, "-jar", "app.jar"]
{% endif %}
