services:
  # Backend API (Spring Boot)
  backend:
    build:
      context: ../containerize-backend
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    volumes:
      - ./uploads:/app/uploads
    environment:
      - SPRING_PROFILES_ACTIVE=${SPRING_PROFILE:-dev}
      - APP_UPLOAD_DIRECTORY=/app/uploads
      - CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-http://localhost:8000,http://127.0.0.1:8000,http://localhost:4000,http://127.0.0.1:4000}
    restart: unless-stopped

  # Frontend (React + Vite)
  frontend:
    build:
      context: ../containerize-frontend
      dockerfile: Dockerfile
      target: development
    ports:
      - "4000:4000"
    volumes:
      - ../containerize-frontend/src:/app/src
      - ../containerize-frontend/public:/app/public
      - ../containerize-frontend/index.html:/app/index.html
    environment:
      - API_TARGET=http://backend:8000
    depends_on:
      - backend
    restart: unless-stopped
