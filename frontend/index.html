<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      WebApp Dockerfile Generator - 웹 서비스용 Dockerfile 자동 생성
    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/dockerfile/dockerfile.min.js"></script>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
      <!-- Header -->
      <header class="mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">
          WebApp Dockerfile Generator
        </h1>
        <p class="text-gray-600">웹 서비스용 Dockerfile 생성 솔루션</p>
      </header>

      <!-- Main Content -->
      <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
        <!-- Step 1: Language Selection -->
        <div id="step-language" class="step">
          <h2 class="text-2xl font-semibold mb-4">1. 개발 언어 선택</h2>
          <div class="grid grid-cols-3 gap-4">
            <button
              id="lang-btn-python"
              onclick="selectLanguage('python')"
              class="lang-btn p-6 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition"
            >
              <div class="flex justify-center items-center mb-2">
                <img
                  src="/static/icons/python.svg"
                  alt="Python"
                  class="w-16 h-16"
                />
              </div>
              <div class="font-semibold">Python</div>
              <div class="text-sm text-gray-500">Flask, FastAPI, Django</div>
            </button>
            <button
              id="lang-btn-nodejs"
              onclick="selectLanguage('nodejs')"
              class="lang-btn p-6 border-2 border-gray-300 rounded-lg hover:border-green-500 hover:bg-green-50 transition"
            >
              <div class="flex justify-center items-center mb-2">
                <img
                  src="/static/icons/nodejs.svg"
                  alt="Node.js"
                  class="w-16 h-16"
                />
              </div>
              <div class="font-semibold">Node.js</div>
              <div class="text-sm text-gray-500">Express, NestJS</div>
            </button>
            <button
              id="lang-btn-java"
              onclick="selectLanguage('java')"
              class="lang-btn p-6 border-2 border-gray-300 rounded-lg hover:border-red-500 hover:bg-red-50 transition"
            >
              <div class="flex justify-center items-center mb-2">
                <img
                  src="/static/icons/java.svg"
                  alt="Java"
                  class="w-16 h-16"
                />
              </div>
              <div class="font-semibold">Java</div>
              <div class="text-sm text-gray-500">Spring Boot</div>
            </button>
          </div>
        </div>

        <!-- Step 2: Java Input (Only for Java) -->
        <div id="step-input" class="step hidden mt-8">
          <h2 class="text-2xl font-semibold mb-4">2. 빌드 Artifact 설정</h2>

          <!-- Java: JAR File Upload -->
          <div id="input-java" class="input-section hidden">
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                JAR 파일 업로드
              </label>
              <input
                type="file"
                id="jarFile"
                accept=".jar,.war"
                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
              />
              <p class="mt-1 text-sm text-gray-500">
                빌드된 JAR 파일을 업로드하세요.
              </p>
            </div>
          </div>

          <button
            onclick="nextToConfig()"
            class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition"
          >
            다음 단계
          </button>
        </div>

        <!-- Step 2/3: Configuration -->
        <div id="step-config" class="step hidden mt-8">
          <h2 class="text-2xl font-semibold mb-4">
            <span id="config-step-number">2</span>. Dockerfile 세부 내용 설정
          </h2>

          <!-- Python/Node.js 필수 필드 -->
          <div id="simple-lang-fields" class="hidden">
            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Base Image <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                id="baseImage"
                required
                class="w-full p-2 border border-gray-300 rounded-md"
                placeholder="예: python:3.11-slim, node:20-alpine"
              />
              <p class="mt-1 text-sm text-gray-500">
                사용할 Docker 베이스 이미지를 입력하세요
              </p>
            </div>

            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                포트 <span class="text-red-500">*</span>
              </label>
              <input
                type="number"
                id="port"
                required
                class="w-full p-2 border border-gray-300 rounded-md"
                placeholder="예: 8000, 3000"
              />
            </div>

            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                서비스 URL <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                id="serviceUrl"
                required
                class="w-full p-2 border border-gray-300 rounded-md"
                placeholder="예: https://api.example.com"
              />
              <p class="mt-1 text-sm text-gray-500">
                서비스가 배포될 URL을 입력하세요
              </p>
            </div>

            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                실행 명령어 <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                id="startCommand"
                required
                class="w-full p-2 border border-gray-300 rounded-md"
                placeholder=""
              />
              <p class="mt-1 text-sm text-gray-500">
                컨테이너 실행 명령어를 입력하세요
              </p>
            </div>
          </div>

          <!-- Java 필드 -->
          <div id="java-lang-fields" class="hidden">
            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Base Image <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                id="javaBaseImage"
                required
                class="w-full p-2 border border-gray-300 rounded-md"
                placeholder="예: eclipse-temurin:17-jre-alpine"
              />
            </div>

            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                포트 <span class="text-red-500">*</span>
              </label>
              <input
                type="number"
                id="javaPort"
                required
                class="w-full p-2 border border-gray-300 rounded-md"
                placeholder="예: 8080"
              />
            </div>

            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                서비스 URL <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                id="javaServiceUrl"
                required
                class="w-full p-2 border border-gray-300 rounded-md"
                placeholder="예: https://api.example.com"
              />
            </div>

            <div class="mt-4">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                실행 명령어 <span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                id="javaStartCommand"
                required
                class="w-full p-2 border border-gray-300 rounded-md"
                placeholder="예: java -jar app.jar"
              />
            </div>
          </div>

          <!-- 공통 선택 필드 -->
          <div class="mt-4">
            <label class="flex items-center mb-2">
              <input
                type="checkbox"
                id="enableEnvVars"
                onchange="toggleEnvVars()"
                class="mr-2"
              />
              <span class="text-sm font-medium text-gray-700">
                환경 변수 추가
              </span>
            </label>
            <div id="envVarsInput" class="hidden">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                환경 변수 (KEY=VALUE, 한 줄에 하나씩)
              </label>
              <textarea
                id="envVars"
                rows="3"
                class="w-full p-2 border border-gray-300 rounded-md font-mono text-sm"
                placeholder="ENV=production&#10;DEBUG=false"
              ></textarea>
            </div>
          </div>

          <div class="mt-4">
            <label class="flex items-center mb-2">
              <input
                type="checkbox"
                id="enableHealthCheck"
                onchange="toggleHealthCheck()"
                class="mr-2"
              />
              <span class="text-sm font-medium text-gray-700">
                Health Check 추가
              </span>
            </label>
            <div id="healthCheckInput" class="hidden">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Health Check 경로
              </label>
              <input
                type="text"
                id="healthCheck"
                value="/health"
                class="w-full p-2 border border-gray-300 rounded-md"
              />
            </div>
          </div>

          <div class="mt-4">
            <label class="flex items-center mb-2">
              <input
                type="checkbox"
                id="enableSystemDeps"
                onchange="toggleSystemDeps()"
                class="mr-2"
              />
              <span class="text-sm font-medium text-gray-700">
                시스템 의존성 패키지 추가
              </span>
            </label>
            <div id="systemDepsInput" class="hidden">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                시스템 의존성 패키지 (공백으로 구분)
              </label>
              <input
                type="text"
                id="systemDeps"
                class="w-full p-2 border border-gray-300 rounded-md"
                placeholder="예: curl wget"
              />
            </div>
          </div>

          <button
            onclick="generateDockerfile()"
            class="mt-6 px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition"
          >
            Dockerfile 생성
          </button>
        </div>

        <!-- Step 4: Preview & Download -->
        <div id="step-preview" class="step hidden mt-8">
          <h2 class="text-2xl font-semibold mb-4">4. Dockerfile 미리보기</h2>

          <div class="mb-4">
            <textarea id="dockerfileEditor"></textarea>
          </div>

          <div class="flex gap-4">
            <button
              onclick="downloadDockerfile()"
              class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition"
            >
              다운로드
            </button>
            <button
              onclick="copyToClipboard()"
              class="px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition"
            >
              클립보드에 복사
            </button>
            <button
              onclick="showResetConfirmation()"
              class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition flex items-center gap-2"
            >
              <span>🔄</span>
              <span>Dockerfile 재생성</span>
            </button>
          </div>
        </div>

        <!-- Loading Indicator -->
        <div
          id="loading"
          class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
        >
          <div class="bg-white p-6 rounded-lg shadow-xl">
            <div
              class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"
            ></div>
            <p class="mt-4 text-gray-700">처리 중...</p>
          </div>
        </div>

        <!-- Reset Confirmation Modal -->
        <div
          id="resetConfirmModal"
          class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
        >
          <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="p-6">
              <div class="flex items-center justify-center mb-4">
                <div class="text-5xl">🔄</div>
              </div>
              <h3 class="text-xl font-semibold text-gray-800 text-center mb-2">
                Dockerfile 재생성
              </h3>
              <p class="text-gray-600 text-center mb-6">
                Dockerfile을 재생성하시겠습니까?
              </p>
              <div class="flex gap-3">
                <button
                  onclick="cancelReset()"
                  class="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition"
                >
                  취소
                </button>
                <button
                  onclick="confirmReset()"
                  class="flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition"
                >
                  재생성
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Alert Modal -->
        <div
          id="alertModal"
          class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
        >
          <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="p-6">
              <div class="flex items-center justify-center mb-4">
                <div id="alertIcon" class="text-5xl">⚠️</div>
              </div>
              <h3
                id="alertTitle"
                class="text-xl font-semibold text-gray-800 text-center mb-2"
              >
                알림
              </h3>
              <p id="alertMessage" class="text-gray-600 text-center mb-6">
                <!-- 동적으로 메시지가 삽입됩니다 -->
              </p>
              <div class="flex justify-center">
                <button
                  onclick="closeAlert()"
                  class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition"
                >
                  확인
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer class="text-center text-gray-500 text-sm">
        <p>WebApp Dockerfile Generator - 웹 서비스 컨테이너라이즈 솔루션</p>
      </footer>
    </div>

    <script src="/static/js/app.js"></script>
  </body>
</html>
